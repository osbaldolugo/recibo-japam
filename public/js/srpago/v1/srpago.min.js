(function(){function e(e,t){this.message=e,this.description=t,this.toString=function(){return this.message}}var t,r;if(!(r=!!/japammovil\.com$/.test("undefined"!=typeof window&&null!==window?window.location.host:void 0))&&"querySelectorAll"in document&&(document.querySelectorAll('script[src^="https://japammovil.com"]').length||console.log("The srpago.js must be included from https://japammovil.com")),t=function(){function e(){}return e._sdkVersion="0.1.1",e._apiVersion="v1",e._liveMode=!1,e._apiBase="https://api.srpago.com",e._apiBaseSandbox="https://sandbox-api.srpago.com",e.setPublishableKey=function(t){e._publishableKey=t},e.getPublishableKey=function(){return e._publishableKey},e.getApiBase=function(){var t=e._apiBase;return 0==e._liveMode&&(t=e._apiBaseSandbox),t},e.setLiveMode=function(t){e._liveMode=t},e.getApiVersion=function(){return e._apiVersion},e.getUserAgent=function(t){return{language:"javascript",sdk_version:e._sdkVersion,api_version:e._apiVersion}},e._isSafeDomain=r,e.request=function(t){return t.crossDomain=!0,t.beforeSend=function(r){var n=e.getUserAgent();t.extra_params&&(n.extra_params=t.extra_params),r.setRequestHeader("X-User-Agent",JSON.stringify(n)),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Authorization","Basic "+btoa(e.getPublishableKey()+":"))},t.data&&"string"!=typeof t.data&&(t.data=JSON.stringify(t.data)),$.ajax(t)},e.reportError=function(e,t){"console"in window&&console.log(e)},e.formatError=function(e,t){return e},e}(),this.SrPago)return this.SrPago.isDoubleLoaded||console.log("Al parecer SrPago.js fue cargado dos veces, favor de revisar con el administrador del sitio."),void(this.SrPago.isDoubleLoaded=!0);this.SrPago=t,this.SrPago.token=function(){function r(){}return r.validate=function(e,t){if(!e)throw t+" required";if("object"!=typeof e)throw t+" invalid"},r.formatData=function(e){var r;e||(e={});for(r in e)null==e[r]&&delete e[r];return expiration=t.card.__getExpirationDate(e.exp_month,e.exp_year),e.expiration=expiration,e},r.create=function(r,n,a){"function"!=typeof n&&(n=function(e){console.log(e)}),"function"!=typeof a&&(a=function(e){console.log(e)});try{r=t.token.formatData(r)}catch(r){return void a(r instanceof e?t.formatError(r):t.formatError())}var o={encrypted:!1};t.encryption&&(r=t.encryption.encrypt(r),o.encrypted=!0);var i={url:t.getApiBase()+"/"+t.getApiVersion()+"/token",data:r,method:"POST",headers:{},extra_params:o,success:function(e,r){return e&&e.result?n(e.result):a(t.formatError(e))},error:function(e,r){return a(t.formatError(e))},timeout:4e4,tokenType:"card"};return t.request(i)},r}(),this.SrPago.card=function(){function t(){}return t.cardTypes=function(){for(var e={34:"AMEX",37:"AMEX"},t=40;t<=49;t++)e[t]="VISA";for(t=50;t<=59;t++)e[t]="MAST";for(t=22;t<=27;t++)e[t]="MAST";return e},t.cardType=function(e){return t.cardTypes[e.slice(0,2)]||"InvalidCardType"},t.validateNumber=t.validateCardNumber=function(e){return(e=(""+e).replace(/\s+|-/g,"")).length>=15&&e.length<=16&&t.luhnValidate(e)},t.validateExpiration=t.validateExpirationDate=function(e,r){try{return t.__getExpirationDate(e,r)}catch(e){return!1}},t.__getExpirationDate=function(r,n){var a=n?(""+parseInt("0"+n)).slice(-2):"",o=r?(""+parseInt("0"+r)).slice(-2):"",i=a+""+(parseInt(o)<10?"0":"")+parseInt(o),s=new Date;s.setMonth(s.getMonth()+2);var c=(n=(s.getYear()+"").slice(-2))+(r=(s.getMonth()<10?"0":"")+s.getMonth());if(!t.between(parseInt(o),1,12))throw new e({code:"InvalidParamException",detail:"exp_month",message:"El mes es requerido, el mes debe ser entre 1 - 12"});if(!t.between(parseInt(a),n,40))throw new e({code:"InvalidParamException",detail:"exp_year",message:"El año es requerido, el año debe ser entre "+n+" - 40"});if(!t.between(parseInt(i),c,3512))throw new e({code:"InvalidParamException",detail:"exp_year",message:"La fecha es inválida"});return i},t.validateCVC=t.validateCVV=function(e){return e=(""+e).trim(),b=/^\d+$/.test(e)&&e.length>=3&&e.length<=4},t.luhnValidate=function(e){var t,r,n,a;for(n=+e[t=e.length-1],a=0;t--;)r=+e[t],n+=++a%2?2*r%10+(r>4):r;return!(n%10)},t.between=function(e,t,r){return(e=e===+e&&e===(0|e)?e:0)>=t&&e<=r},t}()}).call(this);
